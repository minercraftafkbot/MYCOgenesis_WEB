<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MYCOgenesis Blog - Fungi, Facts, and Future Farming</title>
    <link rel="stylesheet" href="../css/tailwind.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .transition-transform {
            transition: transform 0.3s ease-in-out;
        }
        .hover\:scale-105:hover {
            transform: scale(1.05);
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-stone-50 text-slate-800">

    <!-- Navigation -->
    <header class="bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-50 transition-all duration-300">
        <nav class="container mx-auto px-4 sm:px-6 py-3 flex justify-between items-center">
            <!-- Logo -->
            <div class="flex items-center">
                <img src="../images/logo/MYCOgenesis.svg" alt="MYCOgenesis Logo" class="h-10 w-10 sm:h-12 sm:w-12 mr-2 sm:mr-3">
                <span class="font-bold text-lg sm:text-xl text-slate-700">MYCOGenesis</span>
            </div>

            <!-- Desktop Navigation -->
            <div class="hidden lg:flex items-center space-x-2 xl:space-x-6">
                <a href="../index.html#home" class="text-slate-600 hover:text-teal-600 px-3 py-2 rounded-md text-sm font-medium hover:bg-teal-50/50 transition-all duration-200">Home</a>
                <a href="../index.html#about" class="text-slate-600 hover:text-teal-600 px-3 py-2 rounded-md text-sm font-medium hover:bg-teal-50/50 transition-all duration-200">About Us</a>
                <a href="../index.html#mushrooms" class="text-slate-600 hover:text-teal-600 px-3 py-2 rounded-md text-sm font-medium hover:bg-teal-50/50 transition-all duration-200">Our Mushrooms</a>
                <a href="../index.html#smart-farm" class="text-slate-600 hover:text-teal-600 px-3 py-2 rounded-md text-sm font-medium hover:bg-teal-50/50 transition-all duration-200">Smart Farm</a>
                <a href="../index.html#shop" class="text-slate-600 hover:text-teal-600 px-3 py-2 rounded-md text-sm font-medium hover:bg-teal-50/50 transition-all duration-200">Shop</a>
                <a href="../blog/blog.html" class="text-teal-600 font-bold px-3 py-2 rounded-md text-sm font-medium bg-teal-50/50 transition-all duration-200">Blog</a>
                <a href="../index.html#contact" class="text-slate-600 hover:text-teal-600 px-3 py-2 rounded-md text-sm font-medium hover:bg-teal-50/50 transition-all duration-200">Contact</a>
            </div>

            <!-- Authentication Section -->
            <div class="hidden lg:flex items-center space-x-4 ml-4 pl-4 border-l border-slate-200">
                <div id="auth-not-logged-in" class="flex items-center space-x-4"></div>
                <div id="auth-logged-in" class="hidden flex items-center space-x-3"></div>
            </div>

            <!-- Mobile Menu Button -->
            <div class="lg:hidden">
                <button id="mobile-menu-button" class="text-slate-600 hover:text-teal-600 p-2 rounded-md hover:bg-teal-50/50 transition-all duration-200 focus:outline-none">
                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
        </nav>

        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden lg:hidden bg-white/95 border-b border-slate-100">
            <div class="px-4 pt-2 pb-3 space-y-1">
                <a href="../index.html#home" class="block px-3 py-2 text-base font-medium text-slate-600 hover:text-teal-600 hover:bg-teal-50/50 rounded-md">Home</a>
                <a href="../index.html#about" class="block px-3 py-2 text-base font-medium text-slate-600 hover:text-teal-600 hover:bg-teal-50/50 rounded-md">About Us</a>
                <a href="../index.html#mushrooms" class="block px-3 py-2 text-base font-medium text-slate-600 hover:text-teal-600 hover:bg-teal-50/50 rounded-md">Our Mushrooms</a>
                <a href="../index.html#smart-farm" class="block px-3 py-2 text-base font-medium text-slate-600 hover:text-teal-600 hover:bg-teal-50/50 rounded-md">Smart Farm</a>
                <a href="../index.html#shop" class="block px-3 py-2 text-base font-medium text-slate-600 hover:text-teal-600 hover:bg-teal-50/50 rounded-md">Shop</a>
                <a href="../blog/blog.html" class="block px-3 py-2 text-base font-medium text-teal-600 bg-teal-50/50 rounded-md">Blog</a>
                <a href="../index.html#contact" class="block px-3 py-2 text-base font-medium text-slate-600 hover:text-teal-600 hover:bg-teal-50/50 rounded-md">Contact</a>
            </div>
            <!-- Mobile Authentication Section -->
            <div class="px-4 py-3 border-t border-slate-200 space-y-2">
                <div id="mobile-auth-not-logged-in" class="space-y-2"></div>
                <div id="mobile-auth-logged-in" class="hidden space-y-2"></div>
            </div>
        </div>
    </header>

    <main>
        <!-- Hero Section -->
        <section class="py-20 bg-white">
            <div class="container mx-auto px-6 text-center">
                <h1 class="text-4xl md:text-5xl font-bold text-slate-800 mb-4">The MYCOgenesis Blog</h1>
                <p class="text-lg text-slate-600 max-w-2xl mx-auto">Fungi, Facts, and Future Farming: Your source for insights on smart cultivation, mushroom health benefits, and culinary inspiration.</p>
            </div>
        </section>

        <!-- Featured Post Section -->
        <section id="featured-post-section" class="py-12">
            <!-- Featured post will be loaded dynamically -->
        </section>

        <!-- Latest Articles Section -->
        <section class="py-20 bg-stone-100">
            <div class="container mx-auto px-6">
                <div class="flex flex-col md:flex-row items-center justify-between mb-12">
                    <h2 class="text-3xl font-bold text-center md:text-left mb-6 md:mb-0">Latest Articles</h2>
                    
                    <div class="flex flex-wrap items-center gap-4">
                        <!-- Category Filter -->
                        <div class="relative">
                            <select id="category-filter" class="appearance-none bg-white border border-slate-200 rounded-lg px-4 py-2 pr-8 text-slate-700 focus:outline-none focus:ring-2 focus:ring-teal-500">
                                <option value="">All Categories</option>
                                <!-- Categories will be loaded dynamically -->
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-slate-700">
                                <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                    <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
                                </svg>
                            </div>
                        </div>

                        <!-- Sort Filter -->
                        <div class="relative">
                            <select id="sort-filter" class="appearance-none bg-white border border-slate-200 rounded-lg px-4 py-2 pr-8 text-slate-700 focus:outline-none focus:ring-2 focus:ring-teal-500">
                                <option value="latest">Latest First</option>
                                <option value="oldest">Oldest First</option>
                                <option value="popular">Most Popular</option>
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-slate-700">
                                <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                    <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
                                </svg>
                            </div>
                        </div>

                        <!-- Search Input -->
                        <div class="relative flex-grow md:flex-grow-0">
                            <input type="text" id="search-filter" placeholder="Search articles..." 
                                   class="w-full bg-white border border-slate-200 rounded-lg px-4 py-2 text-slate-700 focus:outline-none focus:ring-2 focus:ring-teal-500">
                        </div>
                    </div>
                </div>

                <!-- Loading spinner -->
                <div id="loading-spinner" class="hidden text-center py-8">
                    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-teal-600"></div>
                    <p class="mt-2 text-slate-600">Loading blog posts...</p>
                </div>

                <!-- Error message -->
                <div id="error-message" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4"></div>

                <!-- Blog posts grid -->
                <div id="blog-posts-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Posts will be loaded dynamically -->
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-slate-800 text-stone-300 py-8">
        <div class="container mx-auto px-6 text-center">
            <p>&copy; 2025 MYCOgenesis. All Rights Reserved.</p>
            <div class="flex justify-center space-x-6 mt-4">
                <a href="#" class="hover:text-teal-400">Facebook</a>
                <a href="#" class="hover:text-teal-400">Instagram</a>
                <a href="#" class="hover:text-teal-400">Twitter</a>
            </div>
        </div>
    </footer>

    <!-- Environment Configuration -->
    <script src="../js/env-config.js"></script>

    <!-- Shared Authentication System -->
    <script type="module">
        import { SharedAuthHandler } from '../js/shared-auth.js';
        import { initializeModularFirebase } from '../js/firebase-init.js';
        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";
        
        // Initialize shared authentication for blog page
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('🔄 Initializing authentication for blog page');
            
            try {
                // First initialize Firebase directly to check auth state
                const firebaseServices = await initializeModularFirebase();
                const { auth } = firebaseServices;
                
                // Wait for auth state to be determined before creating handler
                const authPromise = new Promise((resolve) => {
                    const unsubscribe = onAuthStateChanged(auth, (user) => {
                        unsubscribe(); // Only listen once for initial state
                        resolve(user);
                    });
                });
                
                const currentUser = await authPromise;
                
                if (currentUser) {
                    console.log('✅ User already authenticated:', currentUser.email);
                } else {
                    console.log('ℹ️  No authenticated user found');
                }
                
                // Now create the SharedAuthHandler which will properly handle the existing state
                window.blogAuthHandler = new SharedAuthHandler({
                    showDropdown: true,
                    redirectAfterLogin: null
                });
                
                // Also set as main handler for consistency across the site
                window.mainAuthHandler = window.blogAuthHandler;
                
                console.log('✅ Blog page authentication initialized');
                
            } catch (error) {
                console.error('❌ Failed to initialize blog page authentication:', error);
                window.blogAuthHandler = new SharedAuthHandler({
                    showDropdown: true,
                    redirectAfterLogin: null
                });
                window.mainAuthHandler = window.blogAuthHandler;
            }
        });
    </script>

    <!-- Dynamic Content Loading -->
    <script type="module">
        import { BlogLoader } from '../js/dynamic-content/blog-loader.js';
        
        // Initialize blog loader when DOM is loaded
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('🔄 Initializing blog loader...');
            try {
                window.blogLoader = new BlogLoader();
                await window.blogLoader.initialize();
                console.log('✅ Blog loader initialized successfully');
            } catch (error) {
                console.error('❌ Failed to initialize blog loader:', error);
            }
        });
    </script>

    <!-- Real-time Content Service -->
    <script type="module" src="../js/services/real-time-content-service.js"></script>
</body>
</html>
