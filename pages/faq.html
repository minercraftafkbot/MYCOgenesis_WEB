<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FAQ | MYCOgenesis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../css/index.css" />
    <style>
      /* FAQ-specific styles */
      .faq-search {
        background: linear-gradient(135deg, #0d9488, #0f766e);
      }

      .faq-item {
        transition: all 0.3s ease;
        border-left: 4px solid transparent;
      }

      .faq-item:hover {
        border-left-color: #0d9488;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .faq-answer {
        animation: slideDown 0.3s ease-out;
        overflow: hidden;
      }

      @keyframes slideDown {
        from {
          max-height: 0;
          opacity: 0;
        }
        to {
          max-height: 1000px;
          opacity: 1;
        }
      }

      .faq-question {
        cursor: pointer;
        user-select: none;
      }

      .faq-question:hover {
        color: #0d9488;
      }

      /* Rating stars */
      .star-rating {
        display: flex;
        gap: 4px;
      }

      .star {
        font-size: 18px;
        color: #d1d5db;
        cursor: pointer;
        transition: color 0.2s;
      }

      .star:hover,
      .star.active {
        color: #fbbf24;
      }

      /* Category badges */
      .category-badge {
        transition: all 0.2s;
        cursor: pointer;
      }

      .category-badge:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .category-badge.active {
        background: #0d9488;
        color: white;
      }

      /* Search highlighting */
      .highlight {
        background: #fef3cd;
        padding: 2px 4px;
        border-radius: 2px;
        font-weight: 600;
      }

      /* Loading animation */
      .loading-pulse {
        animation: pulse 1.5s infinite;
      }

      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.6; }
      }

      /* Related content cards */
      .related-card {
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .related-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.12);
      }
    </style>
  </head>
  <body class="bg-stone-50 text-slate-800">
    <div id="faq-container"></div>

    <!-- Rate FAQ Modal -->
    <div id="rating-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
      <div class="bg-white rounded-lg p-6 max-w-sm mx-4">
        <h3 class="text-lg font-semibold mb-4">Was this helpful?</h3>
        <div class="star-rating justify-center mb-4" id="modal-stars">
          <span class="star" data-rating="1">⭐</span>
          <span class="star" data-rating="2">⭐</span>
          <span class="star" data-rating="3">⭐</span>
          <span class="star" data-rating="4">⭐</span>
          <span class="star" data-rating="5">⭐</span>
        </div>
        <textarea 
          id="feedback-text" 
          placeholder="Optional feedback..." 
          class="w-full p-3 border rounded-lg mb-4 resize-none" 
          rows="3"
        ></textarea>
        <div class="flex gap-3 justify-end">
          <button onclick="closeRatingModal()" class="px-4 py-2 text-slate-600 hover:text-slate-800">
            Cancel
          </button>
          <button onclick="submitRating()" class="px-4 py-2 bg-teal-600 text-white rounded hover:bg-teal-700">
            Submit
          </button>
        </div>
      </div>
    </div>

    <!-- Dependencies -->
    <script type="module" src="../js/services/sanity-service.js"></script>
    <script type="module" src="../js/utils/ContentRenderer.js"></script>
    <script type="module" src="../js/utils/SEOManager.js"></script>
    <script type="module" src="../js/utils/UIStateManager.js"></script>
    <script type="module" src="../js/components/FAQ.js"></script>
    <script type="module" src="../js/services/service-coordinator.js"></script>
    <script type="module" src="../js/services/enhanced-service-coordinator.js"></script>

    <script>
      let currentRatingFaqId = null;

      // Rating modal functions
      window.openRatingModal = function(faqId) {
        currentRatingFaqId = faqId;
        const modal = document.getElementById('rating-modal');
        modal.classList.remove('hidden');
        
        // Reset form
        document.querySelectorAll('#modal-stars .star').forEach(star => {
          star.classList.remove('active');
        });
        document.getElementById('feedback-text').value = '';
      };

      window.closeRatingModal = function() {
        const modal = document.getElementById('rating-modal');
        modal.classList.add('hidden');
        currentRatingFaqId = null;
      };

      window.submitRating = function() {
        const rating = document.querySelectorAll('#modal-stars .star.active').length;
        const feedback = document.getElementById('feedback-text').value;
        
        if (rating > 0 && currentRatingFaqId) {
          // Submit rating via FAQ component
          if (window.faqComponent) {
            window.faqComponent.submitRating(currentRatingFaqId, rating, feedback);
          }
          
          closeRatingModal();
          
          // Show thank you message
          const toast = document.createElement('div');
          toast.className = 'fixed bottom-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg z-50';
          toast.textContent = 'Thank you for your feedback!';
          document.body.appendChild(toast);
          
          setTimeout(() => {
            toast.remove();
          }, 3000);
        }
      };

      // Star rating interaction
      document.addEventListener('click', (e) => {
        if (e.target.classList.contains('star')) {
          const rating = parseInt(e.target.dataset.rating);
          const stars = document.querySelectorAll('#modal-stars .star');
          
          stars.forEach((star, index) => {
            if (index < rating) {
              star.classList.add('active');
            } else {
              star.classList.remove('active');
            }
          });
        }
      });

      // Search highlighting function
      window.highlightSearchTerm = function(text, term) {
        if (!term || term.length < 2) return text;
        
        const regex = new RegExp(`(${term})`, 'gi');
        return text.replace(regex, '<span class="highlight">$1</span>');
      };

      // Scroll to FAQ function
      window.scrollToFaq = function(faqId) {
        const element = document.getElementById(`faq-${faqId}`);
        if (element) {
          element.scrollIntoView({ behavior: 'smooth', block: 'center' });
          element.classList.add('ring-2', 'ring-teal-400');
          setTimeout(() => {
            element.classList.remove('ring-2', 'ring-teal-400');
          }, 2000);
        }
      };

      // Initialize FAQ
      window.addEventListener('DOMContentLoaded', async () => {
        window.faqComponent = new window.FAQComponent();
        await window.faqComponent.init();
      });

      // Keyboard shortcuts
      document.addEventListener('keydown', (e) => {
        // Escape key for closing modal
        if (e.key === 'Escape') {
          closeRatingModal();
        }
        
        // Ctrl/Cmd + K for search focus
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
          e.preventDefault();
          const searchInput = document.querySelector('[data-search-input]');
          if (searchInput) {
            searchInput.focus();
          }
        }
      });

      // Handle URL parameters for direct FAQ linking
      window.addEventListener('DOMContentLoaded', () => {
        const urlParams = new URLSearchParams(window.location.search);
        const faqId = urlParams.get('faq');
        const category = urlParams.get('category');
        const search = urlParams.get('search');
        
        // Apply filters from URL
        setTimeout(() => {
          if (search && window.faqComponent) {
            window.faqComponent.setSearchTerm(search);
          }
          
          if (category && window.faqComponent) {
            window.faqComponent.setCategory(category);
          }
          
          if (faqId) {
            scrollToFaq(faqId);
          }
        }, 500);
      });
    </script>
  </body>
</html>
