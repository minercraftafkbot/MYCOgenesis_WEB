<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tutorial | MYCOgenesis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../css/index.css" />
    <style>
      /* Tutorial-specific styles */
      .tutorial-fullscreen {
        overflow: hidden;
      }
      
      .tutorial-fullscreen .tutorial-page {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: white;
        z-index: 9999;
        overflow-y: auto;
      }
      
      .tutorial-fullscreen header,
      .tutorial-fullscreen footer {
        display: none;
      }

      /* Step transition animations */
      .tutorial-step {
        animation: fadeIn 0.3s ease-in-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Progress bar animations */
      .bg-teal-600 {
        transition: width 0.5s ease-in-out;
      }

      /* Image modal styles */
      .image-modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
      }

      .image-modal img {
        max-width: 90vw;
        max-height: 90vh;
        object-fit: contain;
      }
    </style>
  </head>
  <body class="bg-stone-50 text-slate-800">
    <div id="tutorial-container"></div>

    <!-- Image Modal (for step images) -->
    <div id="image-modal" class="image-modal hidden" onclick="closeImageModal()">
      <img id="modal-image" src="" alt="" />
      <button onclick="closeImageModal()" class="absolute top-4 right-4 text-white text-2xl hover:text-gray-300">
        Ã—
      </button>
    </div>

    <!-- Dependencies -->
    <script type="module" src="../js/services/sanity-service.js"></script>
    <script type="module" src="../js/utils/ContentRenderer.js"></script>
    <script type="module" src="../js/utils/SEOManager.js"></script>
    <script type="module" src="../js/utils/UIStateManager.js"></script>
    <script type="module" src="../js/components/Tutorial.js"></script>
    <script type="module" src="../js/services/service-coordinator.js"></script>
    <script type="module" src="../js/services/enhanced-service-coordinator.js"></script>

    <script>
      // Query param helper
      function getQueryParam(name) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(name);
      }

      // Image modal functions
      window.openImageModal = function(src, alt) {
        const modal = document.getElementById('image-modal');
        const modalImage = document.getElementById('modal-image');
        modalImage.src = src;
        modalImage.alt = alt;
        modal.classList.remove('hidden');
      };

      window.closeImageModal = function() {
        const modal = document.getElementById('image-modal');
        modal.classList.add('hidden');
      };

      // Video player function
      window.playVideo = function(url) {
        // Create video modal or redirect
        if (url.includes('youtube.com') || url.includes('youtu.be')) {
          // Open YouTube video in new tab
          window.open(url, '_blank');
        } else {
          // For other videos, you might want to create an embedded player
          console.log('Playing video:', url);
        }
      };

      // Initialize Tutorial
      window.addEventListener('DOMContentLoaded', async () => {
        window.tutorialComponent = new window.TutorialComponent();
        const slug = getQueryParam('slug');
        
        if (!slug) {
          document.getElementById('tutorial-container').innerHTML = `
            <div class="min-h-screen flex items-center justify-center">
              <div class="text-center max-w-md mx-auto px-4">
                <div class="text-6xl mb-4">ðŸ“š</div>
                <h1 class="text-2xl font-bold mb-2">No tutorial specified</h1>
                <p class="text-slate-600 mb-6">Please provide a tutorial slug, e.g. ?slug=mushroom-cultivation-basics</p>
                <a href="/tutorials" class="bg-teal-600 hover:bg-teal-700 text-white px-6 py-3 rounded-lg transition-colors">
                  Browse Tutorials
                </a>
              </div>
            </div>
          `;
          return;
        }
        
        await window.tutorialComponent.init(slug);
      });

      // Keyboard shortcuts
      document.addEventListener('keydown', (e) => {
        // Escape key for closing modals
        if (e.key === 'Escape') {
          closeImageModal();
        }
      });
    </script>
  </body>
</html>
